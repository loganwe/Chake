<!DOCTYPE html>
<html>

<head>
    <title>Chake</title>
    <link rel="icon" type="image"
        href="https://cdn.shopify.com/s/files/1/2209/1363/products/3-Checkers-Photo-6.jpg?v=1535653480">
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0;
            height: 100vh;
            background-color: black;
            position: relative;
        }

        .game-area {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            background-color: gray;
            border: 10px solid gold;
        }

        .control-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 0 20px;
        }

        .snake1-controls {
            margin-left: 15px;
        }


        .snake-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .button-container {
            display: grid;
            grid-template-columns: repeat(3, 40px);
            grid-gap: 10px;
        }

        .control-button {
            width: 40px;
            height: 40px;
            font-size: 24px;
            background-color: #333;
            color: white;
            border: 2px solid white;
            border-radius: 2Wpx;
            text-align: center;
            line-height: 40px;
            cursor: pointer;
            user-select: none;
        }

        .control-button:active {
            background-color: #555;
        }

        .restart-button {
            margin-top: 20px;
            width: 200px;
            height: 50px;
            font-size: 24px;
            background-color: #222;
            color: white;
            border: 2px solid white;
            border-radius: 10px;
            text-align: center;
            line-height: 50px;
            cursor: pointer;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .restart-button:active {
            background-color: #444;
        }
    </style>
</head>

<body>
    <div class="game-area">
        <div class="control-panel snake1-controls">
            <div class="snake-controls">
                <h3 style="color: green;">Snake 1</h3>
                <div class="button-container">
                    <div></div>
                    <div class="control-button" id="s1-up">↑</div>
                    <div></div>
                    <div class="control-button" id="s1-left">←</div>
                    <div></div>
                    <div class="control-button" id="s1-right">→</div>
                    <div></div>
                    <div class="control-button" id="s1-down">↓</div>
                    <div></div>
                </div>
            </div>
        </div>

        <canvas id="canvas"></canvas>

        <div class="control-panel snake2-controls">
            <div class="snake-controls">
                <h3 style="color: red;">Snake 2</h3>
                <div class="button-container">
                    <div></div>
                    <div class="control-button" id="s2-up">↑</div>
                    <div></div>
                    <div class="control-button" id="s2-left">←</div>
                    <div></div>
                    <div class="control-button" id="s2-right">→</div>
                    <div></div>
                    <div class="control-button" id="s2-down">↓</div>
                    <div></div>
                </div>
            </div>
        </div>
    </div>

    <div class="restart-button" id="restart-btn">Restart</div>

    <script>
        const canvas = document.querySelector("canvas");
        const c = canvas.getContext("2d");
        canvas.width = 1024;
        canvas.height = 576;

        const snakeSize = 20;
        const maxLength = 50;
        let s1Direction = { x: 0, y: 0 };
        let s2Direction = { x: 0, y: 0 };
        let gameOver = false;
        let winner = null;
        const lastRowY = 548;
        const firstRowY = 8;
        let currentTurn = 1;

        class Snake {
            constructor({ position, color }) {
                this.position = position;
                this.size = snakeSize;
                this.segments = [];
                this.color = color;

                this.segments.push({ x: this.position.x, y: this.position.y });
            }

            draw() {
                c.fillStyle = this.color;
                this.segments.forEach(segment => {
                    c.fillRect(segment.x, segment.y, this.size, this.size);
                });
            }

            moveSnake(direction, opponentSnake) {
                if (gameOver) return;

                const nextHeadX = this.segments[0].x + direction.x * this.size;
                const nextHeadY = this.segments[0].y + direction.y * this.size;

                if (
                    nextHeadX >= 0 && nextHeadX + this.size <= canvas.width &&
                    nextHeadY >= 0 && nextHeadY + this.size <= canvas.height
                ) {
                    if (opponentSnake.segments.some(segment =>
                        nextHeadX === segment.x && nextHeadY === segment.y)) {
                        gameOver = true;
                        winner = opponentSnake.color;
                        return false;
                    }

                    const oldTail = this.segments[this.segments.length - 1];
                    for (let i = this.segments.length - 1; i > 0; i--) {
                        this.segments[i] = { ...this.segments[i - 1] };
                    }

                    this.segments[0].x = nextHeadX;
                    this.segments[0].y = nextHeadY;

                    if (this.segments.length < maxLength) {
                        this.segments.push({ ...oldTail });
                    }

                    return true;
                } else {
                    console.log("Snake hit the boundary.");
                    return false;
                }
            }
        }

        const snake1 = new Snake({
            position: { x: canvas.width / 2, y: lastRowY }, color: "Green"
        });
        const snake2 = new Snake({
            position: { x: canvas.width / 2, y: firstRowY }, color: "Red"
        });

        document.getElementById("s1-up").addEventListener("click", () => handleMoveSnake(1, { x: 0, y: -1 }));
        document.getElementById("s1-down").addEventListener("click", () => handleMoveSnake(1, { x: 0, y: 1 }));
        document.getElementById("s1-left").addEventListener("click", () => handleMoveSnake(1, { x: -1, y: 0 }));
        document.getElementById("s1-right").addEventListener("click", () => handleMoveSnake(1, { x: 1, y: 0 }));

        document.getElementById("s2-up").addEventListener("click", () => handleMoveSnake(2, { x: 0, y: -1 }));
        document.getElementById("s2-down").addEventListener("click", () => handleMoveSnake(2, { x: 0, y: 1 }));
        document.getElementById("s2-left").addEventListener("click", () => handleMoveSnake(2, { x: -1, y: 0 }));
        document.getElementById("s2-right").addEventListener("click", () => handleMoveSnake(2, { x: 1, y: 0 }));

        document.getElementById("restart-btn").addEventListener("click", () => {
            if (gameOver) window.location.reload();
        });

        document.addEventListener("keydown", (event) => {
            if (!gameOver) {
                switch (event.key) {
                    case "ArrowUp":
                        if (currentTurn === 1) handleMoveSnake(1, { x: 0, y: -1 });
                        break;
                    case "ArrowLeft":
                        if (currentTurn === 1) handleMoveSnake(1, { x: -1, y: 0 });
                        break;
                    case "ArrowDown":
                        if (currentTurn === 1) handleMoveSnake(1, { x: 0, y: 1 });
                        break;
                    case "ArrowRight":
                        if (currentTurn === 1) handleMoveSnake(1, { x: 1, y: 0 });
                        break;
                    case "w":
                        if (currentTurn === 2) handleMoveSnake(2, { x: 0, y: -1 });
                        break;
                    case "a":
                        if (currentTurn === 2) handleMoveSnake(2, { x: -1, y: 0 });
                        break;
                    case "s":
                        if (currentTurn === 2) handleMoveSnake(2, { x: 0, y: 1 });
                        break;
                    case "d":
                        if (currentTurn === 2) handleMoveSnake(2, { x: 1, y: 0 });
                        break;
                }
            } else {
                if (event.key == "Enter") window.location.reload();
            }
        });

        function handleMoveSnake(snakeNumber, direction) {
            if (!gameOver) {
                if (snakeNumber === currentTurn) {
                    if (snakeNumber === 1) {
                        s1Direction = { ...direction };
                        const validMove = snake1.moveSnake(s1Direction, snake2);
                        currentTurn = 2;
                    } else if (snakeNumber === 2) {
                        s2Direction = { ...direction };
                        const validMove = snake2.moveSnake(s2Direction, snake1);
                        currentTurn = 1;
                    }
                    checkWinCondition();
                    draw();
                } else {
                    console.log(`It's not Snake ${snakeNumber}'s turn!`);
                }
            }
        }

        function draw() {
            c.clearRect(0, 0, canvas.width, canvas.height);
            c.font = "50px Arial";
            c.fillStyle = "black";
            c.fillText("Turn: " + (currentTurn === 1 ? "Player 1" : "Player 2"), 50, 50);

            snake1.draw();
            snake2.draw();

            if (gameOver) {
                c.font = "50px Arial";
                c.fillStyle = "black";
                c.fillText("Game Over", canvas.width / 2 - 150, canvas.height / 2);
                c.fillText(`${winner} Wins!`, canvas.width / 2 -100, canvas.height / 2 + 60);
                c.fillText("Press Restart", canvas.width / 2 - 100, canvas.height / 2 + 120);
            }
        }

        function checkWinCondition() {
            if (snake1.segments.length === maxLength && snake1.segments.every(segment => segment.y === firstRowY)) {
                gameOver = true;
                winner = "Green";
            }

            if (snake2.segments.length === maxLength && snake2.segments.every(segment => segment.y === lastRowY)) {
                gameOver = true;
                winner = "Red";
            }
        }

        draw();
    </script>
</body>

</html>
